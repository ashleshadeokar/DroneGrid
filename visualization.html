<!DOCTYPE html>
<html lang="en" class="no-js" >
<head>

    <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Data Visualization</title>
    <link rel="stylesheet" href="css/vendor.css">
    <link rel="stylesheet" href="css/styles.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css' rel='stylesheet' />


    <script>
        document.documentElement.classList.remove('no-js');
        document.documentElement.classList.add('js');
    </script>

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="css/vendor.css">
    <link rel="stylesheet" href="css/styles.css">

    <style type="text/css" media="screen">
        .s-styles {
            padding-top: var(--vspace-5);
            padding-bottom: var(--vspace-2);
            position: relative;
        }
        .s-styles .intro h1 {
            margin-top: 0;
        }
    </style>

    <!-- favicons
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">

</head>


<body id="top">


    <!-- preloader
    ================================================== -->
    <div id="preloader">
        <div id="loader"></div>
    </div>


    <!-- page wrap
    ================================================== -->
    <div id="page" class="s-pagewrap">


        <!-- # site header 
        ================================================== -->
        <header class="s-header">

            <div class="row s-header__inner">

                <!-- <div class="s-header__block">
                    <div class="s-header__logo">
                        <a class="logo" href="index.html">
                            <img src="images/logo.svg" alt="Homepage">
                        </a>
                    </div>

                    <a class="s-header__menu-toggle" href="#0"><span>Menu</span></a>
                </div>  -->

                <nav class="s-header__nav">
                    <ul class="s-header__menu-links">
                        <li><a href="./index.html" >Intro</a></li>
                        <li><a href="./index.html#about" >About</a></li>
                        <li><a href="./index.html#technology" >Technology</a></li>
                        <li><a href="./index.html#research">Research</a></li>
                        <li><a href="./index.html#folio" >Applications</a></li>
                        <li><a href="./index.html#team" >Team</a></li>
                        <li><a href="#contact" >Contact</a></li>
                    </ul>
                </nav>

            </div> <!-- end s-header__inner -->

        </header> <!-- end s-header -->


        <!-- # site-content
        ================================================== -->
        <section id="content" class="s-content">


            <!-- intro
            ----------------------------------------------- -->
            <section id="intro" class="s-intro target-section">

                <!-- <div class="s-intro__bg"></div> -->

                <!-- <div class="row s-intro__content"> -->

                    <!-- <div class="s-intro__content-bg"></div> -->

                    <!-- <div class="column lg-12 s-intro__content-inner">
                        
                        <h1 class="s-intro__content-title">
                        We provide creative <br>
                        solutions to turn your <br>
                        ideas into digital reality.
                        </h1>

                        <div class="s-intro__content-buttons">
                            <a href="#download" class="btn btn--stroke s-intro__content-btn smoothscroll">More About Us</a>
                            <a href="https://player.vimeo.com/video/14592941?color=f26522&title=0&byline=0&portrait=0" class="s-intro__content-video-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M7 6v12l10-6z"></path></svg>
                            </a>
                        </div>
                        
                    </div>  -->

                    <section id="about" class="s-about target-section">
                        <div class="row section-header" data-num="01">
                            <h3 class="column lg-12 section-header__pretitle pretitle text-pretitle"></h3>
                            <div class="column lg-6 stack-on-1100 section-header__primary">
                                <!-- <h2 class="title text-display-1">
                                Visualization
                                </h2> -->
                                <p><br>
                                    <br>The data visualized in the map is from a multirotor drone carrying a payload consisting of a GPS with an attached daytime camera that is coaligned with a LiDAR laser to measure distance. Using a Python-based code, our team is able to conduct geolocation from the multirotor. Future research involves conducting object detection combined with this geolocation feature.</p>
                            </div>
                            <div class="column lg-6 image-container">
                                <img src="images/Picture2.jpg" alt="Descriptive Alt Text">
                            </div>
                        </div> <!-- end section-header -->
                    </section>
                </div> <!-- s-intro__content -->

                <section id="about" class="s-about target-section">

                    <div class="row section-header" data-num="02">
                        <h3 class="column lg-12 section-header__pretitle pretitle text-pretitle">Visualization</h3>
                        <div class="column lg-6 stack-on-1100 section-header__primary">

                            <!-- Map container -->
                            <div id="map" style="width: 100vw; height: 100vh;"></div>
                        <div class="map-legend">
                            <h4>Legend</h4>
                            <div><span class="legend-color" style="background-color: #007cbf;"></span>Original Points</div>
                            <div><span class="legend-color" style="background-color: #FF4500;"></span>Laser Points</div>
                            <div><span class="legend-color" style="background-color: #FF00FF;"></span>Drone Initial Position</div>
                        </div>
                    
                        <!-- Load Mapbox -->
                        <script src='https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js'></script>
                        <script>
                            mapboxgl.accessToken = 'pk.eyJ1IjoiYXNobGVzaGFkZW9rYXIiLCJhIjoiY2x6dTk0N2xoMmIzcDJrcHpjajFwaWwzdyJ9.gl0_MGiz2zP5WPMxsXretg';  
                            var map = new mapboxgl.Map({
                                container: 'map',
                                style: 'mapbox://styles/mapbox/streets-v11',
                                center: [-82.2192, 33.4525],
                                zoom: 15
                            });
                    
                            // Fetch the data from the backend
                            fetch('/api/data')
                                .then(response => response.json())
                                .then(data => {
                                console.log(data);
                    
                                // Process the data and add it to the map
                                const geojsonOriginal = {
                                    type: 'FeatureCollection',
                                    features: data.map(point => ({
                                        type: 'Feature',
                                        geometry: { type: 'Point', coordinates: [point.lng, point.lat] },
                                        properties: {
                                            alt: point.alt,
                                            yaw: point.yaw,
                                            pitch: point.pitch,
                                            roll: point.roll
                                        }
                                    }))
                                };
                                
                                const geojsonLaser = {
                                    type: 'FeatureCollection',
                                    features: data.map(point => ({
                                        type: 'Feature',
                                        geometry: { type: 'Point', coordinates: [point.laser_lon, point.laser_lat] },
                                        properties: {
                                            alt: point.alt,
                                            yaw: point.yaw,
                                            pitch: point.pitch
                                        }
                                    }))
                                };
                    
                                // Add sources and layers to the map
                                map.addSource('originalPoints', {
                                    type: 'geojson',
                                    data: geojsonOriginal
                                });
                    
                                map.addSource('laserPoints', {
                                    type: 'geojson',
                                    data: geojsonLaser
                                });
                    
                                map.addLayer({
                                    id: 'originalPoints',
                                    type: 'circle',
                                    source: 'originalPoints',
                                    paint: {
                                        'circle-radius': 5,
                                        'circle-color': '#007cbf'
                                    }
                                });
                    
                                map.addLayer({
                                    id: 'laserPoints',
                                    type: 'circle',
                                    source: 'laserPoints',
                                    paint: {
                                        'circle-radius': 5,
                                        'circle-color': '#FF4500'
                                    }
                                });
                    
                                // Define the initial drone position
                                var droneInitialPosition = {
                                    type: 'FeatureCollection',
                                    features: [{
                                        type: 'Feature',
                                        geometry: {
                                            type: 'Point',
                                            coordinates: [-82.2194838, 33.4530524] // Corrected coordinates (longitude first, latitude second)
                                        },
                                        properties: {
                                            description: 'Initial Drone Position'
                                        }
                                    }]
                                };
                    
                                // Add the initial drone position source and layer to the map
                                map.addSource('droneInitialPosition', {
                                    type: 'geojson',
                                    data: droneInitialPosition
                                });
                    
                                map.addLayer({
                                    id: 'droneInitialPosition',
                                    type: 'circle',
                                    source: 'droneInitialPosition',
                                    paint: {
                                        'circle-radius': 8, // Larger radius for visibility
                                        'circle-color': '#FF00FF' 
                                    }
                                });
                                
                                map.addLayer({
                                    id: 'heatmap',
                                    type: 'heatmap',
                                    source: 'originalPoints',
                                    paint: {
                                        'heatmap-weight': {
                                            property: 'alt',
                                            type: 'exponential',
                                            stops: [
                                                [1, 0],
                                                [62, 1]
                                            ]
                                        },
                                        'heatmap-intensity': {
                                            stops: [
                                                [11, 1],
                                                [15, 3]
                                            ]
                                        },
                                        'heatmap-color': [
                                            'interpolate',
                                            ['linear'],
                                            ['heatmap-density'],
                                            0, 'rgba(33,102,172,0)',
                                            0.2, 'rgb(103,169,207)',
                                            0.4, 'rgb(209,229,240)',
                                            0.6, 'rgb(253,219,199)',
                                            0.8, 'rgb(239,138,98)',
                                            1, 'rgb(178,24,43)'
                                        ],
                                        'heatmap-radius': {
                                            stops: [
                                                [11, 15],
                                                [15, 20]
                                            ]
                                        },
                                        'heatmap-opacity': {
                                            default: 1,
                                            stops: [
                                                [14, 1],
                                                [15, 0]
                                            ]
                                        },
                                    }
                                });
                    
                                // Add line connection source and layer
                                map.addSource('lineConnection', {
                                    type: 'geojson',
                                    data: {
                                        type: 'FeatureCollection',
                                        features: []
                                    }
                                });
                    
                                map.addLayer({
                                    id: 'lineConnection',
                                    type: 'line',
                                    source: 'lineConnection',
                                    layout: {
                                        'line-join': 'round',
                                        'line-cap': 'round'
                                    },
                                    paint: {
                                        'line-color': '#FF8C00',
                                        'line-width': 4
                                    }
                                });
                    
                                // Add interaction for showing popups and drawing lines
                                map.on('mouseenter', 'originalPoints', function (e) {
                                    if (e.features.length > 0) {
                                        const coordinates = e.features[0].geometry.coordinates.slice();
                                        const properties = e.features[0].properties;
                                        createPopup(coordinates, properties);
                                    }
                                });
                    
                                map.on('mouseleave', 'originalPoints', function () {
                                    map.getCanvas().style.cursor = '';
                                    if (map.getPopup()) map.getPopup().remove();
                                });
                    
                                map.on('click', 'originalPoints', function (e) {
                                    if (e.features.length > 0) {
                                        const originalFeature = e.features[0];
                                        const originalCoords = originalFeature.geometry.coordinates;
                    
                                        const correspondingLaserPoint = data.find(p =>
                                            Math.abs(p.lat - originalCoords[1]) < 0.00001 &&
                                            Math.abs(p.lng - originalCoords[0]) < 0.00001
                                        );
                    
                                        if (correspondingLaserPoint) {
                                            const lineFeature = {
                                                type: 'Feature',
                                                geometry: {
                                                    type: 'LineString',
                                                    coordinates: [
                                                        [originalCoords[0], originalCoords[1]],
                                                        [correspondingLaserPoint.laser_lon, correspondingLaserPoint.laser_lat]
                                                    ]
                                                }
                                            };
                    
                                            map.getSource('lineConnection').setData({
                                                type: 'FeatureCollection',
                                                features: [lineFeature]
                                            });
                                        }
                                    }
                                });
                    
                                function createPopup(coordinates, properties) {
                                    const description = `<strong>Altitude:</strong> ${properties.alt}m<br><strong>Yaw:</strong> ${properties.yaw}°<br><strong>Pitch:</strong> ${properties.pitch}°<br><strong>Roll:</strong> ${properties.roll}°`;
                                    return new mapboxgl.Popup({ offset: 25 })
                                        .setLngLat(coordinates)
                                        .setHTML(description)
                                        .addTo(map);
                                }
                    
                                function filterByElevation(value) {
                                    document.getElementById('elevationValue').textContent = value + " meters";
                                    const elevationThreshold = parseInt(value);
                                    map.setFilter('originalPoints', ['<=', ['get', 'alt'], elevationThreshold]);
                                    map.setFilter('laserPoints', ['<=', ['get', 'alt'], elevationThreshold]);
                                }
                    
                                document.getElementById('elevationRange').addEventListener('input', function (e) {
                                    filterByElevation(e.target.value);
                                });
                    
                                filterByElevation(document.getElementById('elevationRange').value);
                            })
                            .catch(error => console.error('Error fetching data:', error));
                        
                    </script>

</div> <!-- end list-block__item -->

</div> <!-- end process-list -->

</section> <!-- end s-about -->

            </section> <!-- end s-intro -->


            <!-- # site-footer
    ================================================== -->
    <footer id="footer" class="s-footer target-section">

        <div class="row section-header" data-num="03">
            <h3 class="column lg-12 section-header__pretitle text-pretitle">Get In Touch</h3>
            <div class="column lg-6 stack-on-1100 section-header__primary">
                <h2 class="title text-display-1">
                    Need more information about our drone technology? We're ready to help. 
                    <!-- Reach out to us at <a href="mailto:jgalla5@gmu.edu" title="">contact@tldsystems.com</a> -->
                </h2>
            </div>    
            <div class="column lg-6 stack-on-1100 section-header__secondary">
                
                <div class="contact-block">
                    <h6>Where To Find Us</h6>
                    <p>
                    4400 University Drive<br>
                    Fairfax, Virginia <br>
                    22030 US
                    </p>
                </div>

                <div class="contact-block">
                    <h6>Contact Info</h6>
                    <ul class="contact-list">
                        <li><a href="mailto:jgalla5@gmu.edu">jgalla5@gmu.edu</a></li>
                    </ul>
                </div>

            </div>
        </div> <!-- end section-header -->

        <div class="row list-block block-lg-one-half block-tab-whole block-stack-on-1000 s-footer__btns">
            <div class="column list-block__item">
                <div class="s-footer__contact-btn">
                    <a href="mailto:jgalla5@gmu.edu" class="btn btn--primary u-fullwidth">
                        Let's Talk 
                    </a>
                </div>
            </div>
            <!-- <div class="column list-block__item">
                <div class="subscribe-form s-footer__subscribe">
                    <h6>Subscribe to Updates</h6>
                    <form id="mc-form" class="mc-form">
                        <input type="email" name="EMAIL" id="mce-EMAIL" class="u-fullwidth text-center" placeholder="Your Email Address" required>
                        <input type="submit" name="subscribe" value="Subscribe" class="btn btn--primary u-fullwidth">
                        <div class="mc-status"></div>
                    </form>
                </div>
            </div> -->
        </div> 
        <!-- end s-footer__btns -->

        <div class="row s-footer__bottom">

            <!-- <div class="column lg-6 tab-12 s-footer__bottom-left">
                <ul class="s-footer__social">
                    <li><a href="https://facebook.com"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20,3H4C3.447,3,3,3.448,3,4v16c0,0.552,0.447,1,1,1h8.615v-6.96h-2.338v-2.725h2.338v-2c0-2.325,1.42-3.592,3.5-3.592 c0.699-0.002,1.399,0.034,2.095,0.107v2.42h-1.435c-1.128,0-1.348,0.538-1.348,1.325v1.735h2.697l-0.35,2.725h-2.348V21H20 c0.553,0,1-0.448,1-1V4C21,3.448,20.553,3,20,3z"></path></svg></a></li>
                    <li><a href="https://twitter.com"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.633,7.997c0.013,0.175,0.013,0.349,0.013,0.523c0,5.325-4.053,11.461-11.46,11.461c-2.282,0-4.402-0.661-6.186-1.809 c0.324,0.037,0.636,0.05,0.973,0.05c1.883,0,3.616-0.636,5.001-1.721c-1.771-0.037-3.255-1.197-3.767-2.793 c0.249,0.037,0.499,0.062,0.761,0.062c0.361,0,0.724-0.05,1.061-0.137c-1.847-0.374-3.23-1.995-3.23-3.953v-0.05 c0.537,0.299,1.16,0.486,1.82,0.511C3.534,9.419,2.823,8.184,2.823,6.787c0-0.748,0.199-1.434,0.548-2.032 c1.983,2.443,4.964,4.04,8.306,4.215c-0.062-0.3-0.1-0.611-0.1-0.923c0-2.22,1.796-4.028,4.028-4.028 c1.16,0,2.207,0.486,2.943,1.272c0.91-0.175,1.782-0.512,2.556-0.973c-0.299,0.935-0.936,1.721-1.771,2.22 c0.811-0.088,1.597-0.312,2.319-0.624C21.104,6.712,20.419,7.423,19.633,7.997z"></path></svg></a></li>
                </ul>
            </div> -->

            <div class="column lg-6 tab-12 s-footer__bottom-right">
                <div class="ss-copyright">
                    <span>© TLD Systems 2024</span> 
                    <br>
                    <span>Designed by <a href="https://www.tldsystems.com/">TLD Systems Team</a></span>
                </div>
            </div>

        </div> <!-- s-footer__bottom -->

        <div class="ss-go-top">
            <a class="smoothscroll" title="Back to Top" href="#top">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
            </a>
        </div> <!-- end ss-go-top -->

    </footer> <!-- end footer -->


    <!-- Java Script
    ================================================== -->
    <script src="js/plugins.js"></script>
    <script src="js/main_vis.js"></script>

</body>
</html>